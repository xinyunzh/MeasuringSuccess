--create a view of baseline data and the 2018 Q4 checkin data														 
create view baseline_checkin as
select s1.*,s2.* from														 
(select d.*, e.accessemployment as accessemployment_baseline, e.employmentstatus as employmentstatus_baseline, e.employmentstartdate as employmentstartdate_baseline,
 e.employmentretention as employmentretention_baseline, e.jobtrainingenrolled as jobtrainingenrolled_baseline, e.jobtrainingcompleted as jobtrainingcompleted_baseline,
 f.savings as savings_baseline, f.creditscore as creditscore_baseline, f.debt as debt_baseline, i.incomeclient as incomeclient_baseline, i.incomehh as incomehh_baseline,
 i.publicbenefits as publicbenefits_baseline, i.expenseshh as expenseshh_baseline, bc.accessincome as accessincome_baseline, 
 bc.accessfinancialcoach as accessfinancialcoach_baseline, bc.bundledservices as bundledservices_baseline, fc.fincap_budget as fincap_budget_baseline, fc.fincap_goals as fincap_goals_baseline,
 fc.fincap_emergencyfund as fincap_emergencyfund_baseline, fc.fincap_autodeposit as fincap_autodeposit_baseline, fc.fincap_incomeexpenses as fincap_incomeexpenses_baseline, 
 fc.fincap_latefee as fincap_latefee_baseline
from demographic d join records r on r.clientid = d.clientid
left join employment e on e.employmentid = r.employmentid
left join financials f on f.financialsid=r.financialsid
left join fincap fc on fc.fincapid=r.fincapid														 
left join incomeexpenses i on i.incomeexpensesid=r.incomeexpensesid														 
left join bundledservices_checkin bc on bc.bundledservicesid=r.bundledservicesid														 
where r.baseline_baseline is true) s1											 
left join														 
(select d.clientid as clientid_checkin,r.quarter as quarter_checkin, e.accessemployment as accessemployment_checkin, e.employmentstatus as employmentstatus_checkin, e.employmentstartdate as employmentstartdate_checkin,
 e.employmentretention as employmentretention_checkin, e.jobtrainingenrolled as jobtrainingenrolled_checkin, e.jobtrainingcompleted as jobtrainingcompleted_checkin,
 f.savings as savings_checkin, f.creditscore as creditscore_checkin, f.debt as debt_checkin, i.incomeclient as incomeclient_checkin, i.incomehh as incomehh_checkin,
 i.publicbenefits as publicbenefits_checkin, i.expenseshh as expenseshh_checkin, bc.accessincome as accessincome_checkin, 
 bc.accessfinancialcoach as accessfinancialcoach_checkin, bc.bundledservices as bundledservices_checkin, fc.fincap_budget as fincap_budget_checkin, fc.fincap_goals as fincap_goals_checkin,
 fc.fincap_emergencyfund as fincap_emergencyfund_checkin, fc.fincap_autodeposit as fincap_autodeposit_checkin, fc.fincap_incomeexpenses as fincap_incomeexpenses_checkin, 
 fc.fincap_latefee as fincap_latefee_checkin
from demographic d join records r on r.clientid = d.clientid
left join employment e on e.employmentid = r.employmentid
left join financials f on f.financialsid=r.financialsid
left join fincap fc on fc.fincapid=r.fincapid														 
left join incomeexpenses i on i.incomeexpensesid=r.incomeexpensesid														 
left join bundledservices_checkin bc on bc.bundledservicesid=r.bundledservicesid														 
where r.quarter = (select date from records
order by date desc
limit 1) and r.baseline_baseline is false) s2
on s1.clientid = s2.clientid_checkin







---export to excel---
copy
(select s1.*,s2.* from														 
(select d.*, e.accessemployment as accessemployment_baseline, e.employmentstatus as employmentstatus_baseline, e.employmentstartdate as employmentstartdate_baseline,
 e.employmentretention as employmentretention_baseline, e.jobtrainingenrolled as jobtrainingenrolled_baseline, e.jobtrainingcompleted as jobtrainingcompleted_baseline,
 f.savings as savings_baseline, f.creditscore as creditscore_baseline, f.debt as debt_baseline, i.incomeclient as incomeclient_baseline, i.incomehh as incomehh_baseline,
 i.publicbenefits as publicbenefits_baseline, i.expenseshh as expenseshh_baseline, bc.accessincome as accessincome_baseline, bc.accessemployment as accessemployment_baseline,
 bc.accessfinancialcoach as accessfinancialcoach_baseline, bc.bundledservices as bundledservices_baseline, fc.fincap_budget as fincap_budget_baseline, fc.fincap_goals as fincap_goals_baseline,
 fc.fincap_emergencyfund as fincap_emergencyfund_baseline, fc.fincap_autodeposit as fincap_autodeposit_baseline, fc.fincap_incomeexpenses as fincap_incomeexpenses_baseline, 
 fc.fincap_latefee as fincap_latefee_baseline
from demographic d join records r on r.clientid = d.clientid
left join employment e on e.employmentid = r.employmentid
left join financials f on f.financialsid=r.financialsid
left join fincap fc on fc.fincapid=r.fincapid														 
left join incomeexpenses i on i.incomeexpensesid=r.incomeexpensesid														 
left join bundledservices_checkin bc on bc.bundledservicesid=r.bundledservicesid														 
where r.baseline_baseline is true) s1											 
left join														 
(select d.clientid,r.quarter, e.accessemployment as accessemployment_checkin, e.employmentstatus as employmentstatus_checkin, e.employmentstartdate as employmentstartdate_checkin,
 e.employmentretention as employmentretention_checkin, e.jobtrainingenrolled as jobtrainingenrolled_checkin, e.jobtrainingcompleted as jobtrainingcompleted_checkin,
 f.savings as savings_checkin, f.creditscore as creditscore_checkin, f.debt as debt_checkin, i.incomeclient as incomeclient_checkin, i.incomehh as incomehh_checkin,
 i.publicbenefits as publicbenefits_checkin, i.expenseshh as expenseshh_checkin, bc.accessincome as accessincome_checkin, bc.accessemployment as accessemployment_checkin,
 bc.accessfinancialcoach as accessfinancialcoach_checkin, bc.bundledservices as bundledservices_checkin, fc.fincap_budget as fincap_budget_checkin, fc.fincap_goals as fincap_goals_checkin,
 fc.fincap_emergencyfund as fincap_emergencyfund_checkin, fc.fincap_autodeposit as fincap_autodeposit_checkin, fc.fincap_incomeexpenses as fincap_incomeexpenses_checkin, 
 fc.fincap_latefee as fincap_latefee_checkin
from demographic d join records r on r.clientid = d.clientid
left join employment e on e.employmentid = r.employmentid
left join financials f on f.financialsid=r.financialsid
left join fincap fc on fc.fincapid=r.fincapid														 
left join incomeexpenses i on i.incomeexpensesid=r.incomeexpensesid														 
left join bundledservices_checkin bc on bc.bundledservicesid=r.bundledservicesid														 
where r.quarter = (select date from records
order by date desc
limit 1) and r.baseline_baseline is false) s2
on s1.clientid = s2.clientid)
to 'C:\Users\Leah\Desktop\database\exports\baseline_checkin.csv' with csv header;	